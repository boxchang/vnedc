{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="{{ request.LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ever Global - {% block title %} {% endblock %}</title>
    <link rel="stylesheet" href="{% static 'jquery-ui/jquery-ui.min.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap-4.1.3/css/bootstrap.min.css' %}">
    <script src="{% static 'jquery/jquery-3.3.1.min.js' %}"></script>
    <script src="{% static 'jquery-ui/jquery-ui.min.js' %}"></script>
    <script src="{% static 'bootstrap-4.1.3/js/bootstrap.min.js' %}"></script>
    <link href="{% static 'jquery.loading/css/jquery.loading.min.css' %}" rel="stylesheet" />
    <script src="{% static 'jquery.loading/js/jquery.loading.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'fontawesome-5.4.2/css/all.css' %}">
    <link rel="stylesheet" href="{% static 'base/css/base.css' %}">
</head>
<body>
    <div class="sidebar collapsed" id="sidebar">
        <div class="toggle-btn" id="toggle-btn">
            <i class="fas fa-bars"></i>
        </div>
        <div class="top-links">
            <ul>
                <li>
                    {% include 'bases/lang.html' %}
                </li>
            </ul>
        </div>
        <ul>
            <li><a href="{% url 'collection_index' %}"><i class="fas fa-cogs"></i> <span>{% trans "Key Parameter" %}</span></a></li>
        </ul>
        <div class="bottom-links">
            <div class="user-info">
                <ul>
                    <li><i class="fas fa-user"></i> <span>{{ user.username }}</span></li>
                </ul>
            </div>
            <ul>
                <li><a href="{% url 'user_info' %}"><i class="fas fa-key"></i> <span>{% trans 'Personal Setting' %}</span></a></li>
                <li><a href="{% url 'logout' %}"><i class="fas fa-sign-out-alt"></i> <span>{% trans "Logout" %}</span></a></li>
            </ul>
        </div>
    </div>
    <div class="content" id="content" style="position: relative;">
        <div class="container-fluid" style="padding-left: 0px;padding-right: 0px">
            <div class="card-header">
                {% if user.is_authenticated %}
                <form action="{% url 'rd_report' %}" method="POST" id="session_form">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-3">
                            <div id="div_id_plant" class="form-group">
                                <label for="id_plant" class="requiredField">
                                    {% trans "Plant" %}<span class="asteriskField">*</span>
                                </label>
                                <div>
                                    <select name="plant" onchange="set_session();plant_change();" class="select custom-select" required="" id="id_plant">
                                        <option value="">---------</option>
                                        {% for plant in plants %}
                                        <option value="{{ plant }}" {% if plant.plant_code == sPlant %} selected {% endif %}>{{ plant }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div id="div_id_mach" class="form-group">
                                <label for="id_mach" class="requiredField">
                                    {% trans "Machine" %}<span class="asteriskField">*</span>
                                </label>
                                <div>
                                    <select name="mach" onchange="set_session()" class="select custom-select" required="" id="id_mach">
                                        <option value="">---------</option>
                                        {% for mach in machs %}
                                        <option value="{{ mach.mach_code }}" {% if mach.mach_code == sMach %} selected {% endif %}>{{ mach.mach_name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <label for="data_date">{% trans "Record Date" %}*</label>
                            <input id="id_data_date" class="form-control" name="data_date" type="date" value="{{ sData_date }}" required="" />
                        </div>
                        <div class="col-md-3">
                        <label for="data_date"></label>
                            <div class="box-nav-container row">
                                <a class="box-nav-btn" style="margin-top:0.5cm;margin-left: 0.75cm;" href="/chart/param_value/" role="button" data-bs-toggle="tooltip" data-bs-placement="right" title="Chart">
                                    <i class="fas fa-chart-line"></i>
                                </a>

                                <a class="box-nav-btn" style="margin-top:0.5cm;margin-left: 0.75cm;" href="/chart/param_value_product/" role="button" data-bs-toggle="tooltip" data-bs-placement="right" title="Chart">
                                    <i class="fas fa-chart-bar"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
                {% endif %}
            </div>
            <div class="content">
                <div style="margin-left:84%">
                    <form action="{% url 'download_excel' %}" method="get">
                            <button type="submit">Download Excel</button>
                    </form>
                </div>
                <div class="row m-3" style="height:500px">
                    <div class="col-12"  id="myTable">
                        <div class="container">
                            <table class="table table-bordered">
                                <thead class="text-center">
                                    <tr>
                                        <th class="col-md-4 align-middle" rowspan="3" id="1-1">ITEM</th>
                                        <th class="col-md-2 align-middle" rowspan="3" id="1-2">Parameters</th>
                                        <th class="col-md-2 align-middle" rowspan="3" id="1-3">Spec.</th>
                                        <th class="col-md-4" colspan="4"  id="1-4">Sample time</th>
                                    </tr>
                                    <tr>
                                        <th class="col-md-1" id="2-4">1</th>
                                        <th class="col-md-1" id="2-5">2</th>
                                        <th class="col-md-1" id="2-6">3</th>
                                        <th class="col-md-1" id="2-7">4</th>
                                    </tr>
                                    <tr>
                                        <td id="3-4">0h</td>
                                        <td id="3-5">6h</td>
                                        <td id="3-6">12h</td>
                                        <td id="3-7">18h</td>
                                    </tr>
                                </thead>
                            </table>
                        </div>

                        <div class="container">
                            <div class="row no-gutters">
                                <div class="col-md-6" id="table-letf">
                                    <table class="table table-bordered" id="myTable">
                                        <tr>
                                            <th class="col-md-8" style="padding-left: 1cm" id="5-1">Acid tank 1</th>
                                            <td id="5-2">%</td>
                                        </tr>
                                        <tr>
                                            <th class="col-md-8" style="padding-left: 1cm" id="6-1">Acid tank 2</th>
                                            <td id="6-2">%</td>
                                        </tr>
                                        <tr>
                                            <th class="col-md-8" style="padding-left: 1cm" id="7-1">Alkaline tank 1</th>
                                            <td id="7-2">%</td>
                                        </tr>
                                        <tr>
                                            <th class="col-md-8" style="padding-left: 1cm" id="8-1">Alkaline tank 2</th>
                                            <td id="8-2">%</td>
                                        </tr>
                                        <tr>
                                            <th class="col-md-8 align-middle" style="padding-left: 1cm" rowspan="3" id="9-1">Coagulant A</th>
                                            <td id="9-2">CN (%)</td>
                                        </tr>
                                        <tr>
                                            <td id="10-2">CPF (%)</td>
                                        </tr>
                                        <tr>
                                            <td id="11-2">pH Value</td>
                                        </tr>
                                        <tr>
                                            <th class="col-md-8 align-middle" style="padding-left: 1cm" rowspan="3" id="12-1">Coagulant B</th>
                                            <td id="12-2">CN (%)</td>
                                        </tr>
                                        <tr>
                                            <td id="13-2">CPF (%)</td>
                                        </tr>
                                        <tr>
                                            <td id="14-2">pH Value</td>
                                        </tr>
                                        <tr>
                                            <th class="col-md-8 align-middle" style="padding-left: 1cm" rowspan="2" id="15-1">Latex SIDE A-1</th>
                                            <td id="15-2">TSC %</td>
                                        </tr>
                                        <tr>
                                            <td id="16-2">pH Value</td>
                                        </tr>
                                        <tr>
                                            <th class="col-md-8 align-middle" style="padding-left: 1cm" rowspan="2" id="17-1">Latex SIDE A-2</th>
                                            <td id="17-2">TSC %</td>
                                        </tr>
                                        <tr>
                                            <td id="18-2">pH Value</td>
                                        </tr>
                                        <tr>
                                            <th class="col-md-8 align-middle" style="padding-left: 1cm" rowspan="2" id="19-1">Latex SIDE B-1</th>
                                            <td id="19-2">TSC %</td>
                                        </tr>
                                        <tr>
                                            <td id="20-2">pH Value</td>
                                        </tr>
                                        <tr>
                                            <th class="col-md-8 align-middle" style="padding-left: 1cm" rowspan="2" id="21-1">Latex SIDE B-2</th>
                                            <td id="21-2">TSC %</td>
                                        </tr>
                                        <tr>
                                            <td id="22-2">pH Value</td>
                                        </tr>
                                        <tr>
                                            <th class="col-md-8" style="padding-left: 1cm" id="23-1">Chlorination</th>
                                            <td id="23-2">ppm</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="col-md-6" id="table-right">
                                    <table class="table table-bordered">
                                        {% for define in defines %}
                                            <tr>
                                                <td class="col-md-4"></td>
                                                <!-- First Cell: data_time == "00" -->
                                                <td id="{{ forloop.counter|add:4 }}-4">
                                                    {% for value in define.values %}
                                                        {% if value.data_time == "00" %}
                                                            {{ value.parameter_value }}
                                                        {% endif %}
                                                    {% endfor %}
                                                </td>

                                                <!-- Second Cell: data_time == "06" -->
                                                <td id="{{ forloop.counter|add:4 }}-5">
                                                    {% for value in define.values %}
                                                        {% if value.data_time == "06" %}
                                                            {{ value.parameter_value }}
                                                        {% endif %}
                                                    {% endfor %}
                                                </td>

                                                <!-- Third Cell: data_time == "12" -->
                                                <td id="{{ forloop.counter|add:4 }}-6">
                                                    {% for value in define.values %}
                                                        {% if value.data_time == "12" %}
                                                            {{ value.parameter_value }}
                                                        {% endif %}
                                                    {% endfor %}
                                                </td>

                                                <!-- Fourth Cell: data_time == "18" -->
                                                <td id="{{ forloop.counter|add:4 }}-7">
                                                    {% for value in define.values %}
                                                        {% if value.data_time == "18" %}
                                                            {{ value.parameter_value }}
                                                        {% endif %}
                                                    {% endfor %}
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.getElementById('toggle-btn').addEventListener('click', function () {
            var sidebar = document.getElementById('sidebar');
            var content = document.getElementById('content');
            sidebar.classList.toggle('collapsed');
            sidebar.classList.toggle('expanded');
            content.classList.toggle('expanded');
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script>
        $(document).ready(function() {
            $('table').each(function() {
                var maxHeight = 0;
                $(this).find('td').each(function() {
                    var height = $(this).height();
                    if (height > maxHeight) {
                        maxHeight = height;
                    }
                });
                $(this).find('td').height(25); //maxheight
            });
        });
    </script>
    <script>
        function set_session() {
            var plant = $("#id_plant").val();
            var mach = $("#id_mach").val();
            var data_date = $("#id_data_date").val();
            if(plant!="" && mach !="" && data_date != "") {

            $("#session_form").submit();
            }
        }

        function plant_change() {
            $.ajax({
                url: '{% url 'get_mach_api' %}', type: 'post',
                dataType: 'json',
                data: {"csrfmiddlewaretoken": "{{ csrf_token }}", "plant": $("#id_plant :selected").val()},
                success: function(data) {
                    $("#id_mach").html(data);
                }
            });
        }
    </script>
    <script>
       $(document).ready(function() {
            // Handle Plant change
            $('#id_plant').on('change', function () {
                $('#session_form').attr('action', '/collection/rd_report/');
                $('#session_form').submit();
            });

            // Handle Machine change
            $('#id_mach').on('change', function () {
                $('#session_form').attr('action', '/collection/rd_report/');
                $('#session_form').submit();
            });

            // Handle Date change
            $('#id_data_date').on('change', function () {
                $('#session_form').attr('action', '/collection/rd_report/');
                $('#session_form').submit();
            });
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var dateInput = document.getElementById('id_data_date');
            if (!dateInput.value) {  // If no date is already set
                var today = new Date().toISOString().split('T')[0];
                dateInput.value = today;
            }
        });
    </script>

</body>
</html>
{#Xử lí hai giá trị cùng 1 data_time#}